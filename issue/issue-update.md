---
description: 既存Issueの本文更新またはコメント追加を行う
---

# Issue更新

既存のIssueに対して、本文の更新またはコメントの追加を行います。
主にレビューNG時の「仕様バグ」「実装バグ」対応に使用します。

## 引数

- `<Issue番号>` — 対象のIssue番号
  - 単一: `101`
  - 複数: `101,102,103`（カンマ区切り）
  - 省略時は直前のissue-workで扱ったIssueを使用

## オプション

- `--body` — Issue本文を更新する（デフォルト）
- `--comment` — Issueにコメントを追加する

## 手順

### A. Issue本文の更新（仕様バグ対応）

1. **対象Issueの確認**
    - 現在のIssue内容を確認する:
    ```bash
    gh issue view $ISSUE_NUMBER
    ```

2. **更新内容の整理**
    - ユーザーと対話しながら、以下を明確にする:
      - 追加・修正が必要な要件
      - 変更の理由（レビューNGの原因）
      - 新しいスコープ境界（ある場合）

3. **Issue本文の更新**
    - 既存内容をベースに、追記・修正を行う:
    ```bash
    gh issue edit $ISSUE_NUMBER --body "$(cat <<'EOF'
    ## 元の内容
    [既存の内容]

    ---

    ## 追記（YYYY-MM-DD）

    ### 要件の追加・修正
    - [追加・修正された要件]

    ### 理由
    - レビュー時に要件の不足が判明
    EOF
    )"
    ```

4. **更新結果の確認**
    ```bash
    gh issue view $ISSUE_NUMBER
    ```

5. **次のステップ**
    > ✅ Issueを更新しました。次のステップ: `/issue-work` で再実装してください。

### B. Issueへのコメント追加（実装バグ対応）

1. **対象Issueの確認**
    - 現在のIssue内容を確認する:
    ```bash
    gh issue view $ISSUE_NUMBER
    ```

2. **コメント内容の整理**
    - ユーザーと対話しながら、以下を明確にする:
      - 実装のどの部分が要件通りでないか
      - 期待される動作
      - 修正の方向性

3. **コメントの追加**
    ```bash
    gh issue comment $ISSUE_NUMBER --body "$(cat <<'EOF'
    ## 修正指示（YYYY-MM-DD）

    ### 問題点
    - [実装が要件通りでない箇所]

    ### 期待される動作
    - [本来あるべき動作]

    ### 修正方針
    - [修正の方向性]
    EOF
    )"
    ```

4. **コメント結果の確認**
    ```bash
    gh issue view $ISSUE_NUMBER --comments
    ```

5. **次のステップ**
    > ✅ コメントを追加しました。次のステップ: `/issue-work` で再実装してください。

## 複数Issueの場合

複数Issueを指定した場合は、順次処理します：

```bash
# 各Issueに対して本文更新またはコメント追加
for issue in 101 102 103; do
  gh issue edit $issue --body "..."
done
```

## 使用例

### 仕様バグ対応（本文更新）
```bash
# レビューで「要件が不足している」と判明
/issue-update 101
# → 要件を追加・修正
# → /issue-work 101 で再実装
```

### 実装バグ対応（コメント追加）
```bash
# レビューで「実装が要件通りでない」と判明
/issue-update 101 --comment
# → 修正指示をコメント
# → /issue-work 101 で再実装
```

## エラーハンドリング

| エラー | 対処 |
|--------|------|
| Issueが存在しない | エラー終了。「Issueが見つかりません」 |
| 権限がない | エラー終了。「Issueの編集権限がありません」 |
| 更新内容が空 | エラー終了。「更新内容を入力してください」 |

## 注意事項

- 本文更新は既存内容を上書きせず、追記形式を推奨
- コメントは具体的な修正指示を含めること
- 更新後は必ず `/issue-work` で再実装すること
