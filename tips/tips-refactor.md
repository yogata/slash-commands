---
description: inbox.mdからトピック別ファイルに学びを整理する
---

# 学びの整理（Refactor）

`docs/tips/inbox.md` に蓄積された学びを、タグベースでトピック別ファイルに整理します。

---

## 手順

### 1. inbox.mdの内容を分析

```bash
# inbox.mdの存在確認と内容取得
cat docs/tips/inbox.md
```

- ファイルがない場合 → エラー終了。「inbox.mdが存在しません」
- 学びが0件の場合 → 「整理対象の学びがありません」と報告して終了

### 2. タグの抽出と分類

inbox.md内の各学びからタグ（`#xxx` 形式）を抽出し、トピックを判定：

1. 各学びの `**タグ**` 行から `#xxx` を抽出
2. タグを正規化（小文字化、重複排除）
3. 同じタグを持つ学びをグループ化

**分類ルール**:
- 単一タグの場合: そのタグ名のトピックファイルへ
- 複数タグの場合: 最も関連性の強いタグのトピックファイルへ（ユーザーに確認）
- 新規タグの場合: 新しいトピックファイルを作成

### 3. 既存トピックファイルの確認

```bash
# 既存のトピックファイル一覧
ls docs/tips/*.md | grep -v inbox.md
```

- トピックファイル命名規則: `{primary-tag}-lessons.md`
  - 例: `search-lessons.md`, `typescript-lessons.md`, `supabase-lessons.md`

### 4. ユーザー確認

整理案をユーザーに提示し、確認を求める：

```
## 整理案

| 学びタイトル | タグ | 格納先 |
|-------------|------|--------|
| XXX | #search #grep | search-lessons.md |
| YYY | #typescript | typescript-lessons.md |

- 新規作成: typescript-lessons.md
- 追記先: search-lessons.md（既存）

この内容で整理してよろしいですか？（y/n）
```

- ユーザーが承認しない場合 → 修正案を聞くか終了

### 5. トピック別ファイルへの統合

#### 5.1 新規ファイル作成の場合

以下の構造で作成：

```markdown
# {トピック名}関連の学び

{トピック名}に関する開発中の学びや教訓をまとめています。

---

## YYYY-MM-DD: タイトル

- **事象**: ...
- **原因**: ...
- **対策**: ...
- **関連**: `file/path.ts`
- **タグ**: #xxx #yyy

---
```

#### 5.2 既存ファイルへのマージ

**重要**: 単純な追記ではなく、構造を保ちながら統合：

1. 既存ファイルの構造を確認
2. 重複する内容がある場合は統合（1つのセクションにまとめる）
3. 関連する内容は近くに配置
4. 日付順（新しい順）を維持
5. ヘッダー構造を統一

**マージ手順**:
```
a. 既存ファイルの内容を読む
b. 新しい学びの挿入位置を決定（日付順）
c. 重複チェック:
   - 同じ事象・原因の学び → 統合して1つに
   - 似ているが異なる学び → 両方残す（相互参照を追加）
d. 編集後のファイルを書き込み
```

### 6. AGENTS.md参照の更新

新しいトピックファイルを作成した場合、AGENTS.mdの「学び・Tips」セクションを更新：

```markdown
### 参照タイミング

| 状況 | 参照先 |
|------|--------|
| 常時参照 | `docs/tips/inbox.md`（最新の学び） |
| バグ修正時 | `docs/tips/` 内の関連トピックファイル |
| 調査・検索時 | `docs/tips/` 内の関連トピックファイル |
| 実装時 | `docs/tips/` 内の関連トピックファイル |
| {トピック名}関連 | `docs/tips/{topic}-lessons.md` |  ← 追加
```

### 7. inbox.mdのクリア

整理完了後、inbox.mdを初期状態にリセット：

```markdown
# 学び・教訓

このドキュメントは、開発過程で得た教訓や失敗から学んだことを記録する。
まだ整理されていない学びを一時的に保存し、十分な数が溜まったら分類・整理して永続的なドキュメントに移動する。

---
```

**注意**: クリア前に必ずユーザーの最終確認を得る。

### 8. 完了報告

```
## 整理完了

- 処理した学び: X件
- 新規作成: {filename}.md
- 更新: {filename}.md
- AGENTS.md更新: あり/なし
- inbox.md: クリア済み

保存先:
- docs/tips/{topic}-lessons.md
```

---

## エラーハンドリング

| エラー                     | 対処                                               |
| -------------------------- | -------------------------------------------------- |
| inbox.mdが存在しない       | エラー終了。「先に `/tips-add` で学びを追加してください」 |
| 学びが0件                  | 「整理対象の学びがありません」と報告して終了       |
| ユーザーが承認しない       | 修正案を聞く、または「整理をキャンセルしました」   |
| トピックファイル作成失敗   | エラー内容を報告、inbox.mdは変更しない             |
| マージ中にエラー           | ロールバックして元の状態に戻す                     |

---

## 使用例

```
/tips-refactor
```

→ inbox.mdの内容を分析し、整理案を提示

```
整理案を確認しました。y で実行、n でキャンセル
```

→ ユーザー承認後にトピック別ファイルへ統合

---

## 注意事項

- **自動実行禁止**: 必ずユーザーの確認を得てから実行
- **構造保護**: 既存ファイルの構造を壊さないよう注意深くマージ
- **重複排除**: 同じ内容の学びは統合して冗長性を排除
- **バックアップ**: 編集前の状態を念のため確認できるよう、変更内容を報告
